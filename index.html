
<html>

<head>

	<title>Overnight Creation</title>
	<script src="//cdnjs.cloudflare.com/ajax/libs/socket.io/2.0.3/socket.io.js"></script>
	    <script src="/socket.io/socket.io.js"></script>

</head>

<body id="bdy">
	<div style="visibility: hidden">
	    <h1><a href="javascript:xTest()">Socket.IO Test</a></h1>
	    <div id="strx"></div>
	    <div id="stry"></div>
	    <div id="strz"></div>
	    <div id="strtot"></div>
	</div>
</body>

<script>

var tot = 0;
var colortot = 0;

var socket = io.connect();

//document.getElementById('bdy').style.backgroundColor= "rgb( 247, 73, 3 )";

socket.on('colortot', function (data) {
	colortot = data.color;

	socket.emit('color', Math.min(tot,100));
	});



/**
 * HSV to RGB color conversion
 *
 * H runs from 0 to 360 degrees
 * S and V run from 0 to 100、
 * 
 * Ported from the excellent java algorithm by Eugene Vishnevsky at:
 * http://www.cs.rit.edu/~ncs/color/t_convert.html
 */
function hsvToRgb(h, s, v) {
	var r, g, b;
	var i;
	var f, p, q, t;
 
	// Make sure our arguments stay in-range
	h = Math.max(0, Math.min(360, h));
	s = Math.max(0, Math.min(100, s));
	v = Math.max(0, Math.min(100, v));
 
	// We accept saturation and value arguments from 0 to 100 because that's
	// how Photoshop represents those values. Internally, however, the
	// saturation and value are calculated from a range of 0 to 1. We make
	// That conversion here.
	s /= 100;
	v /= 100;
 
	if(s == 0) {
		// Achromatic (grey)
		r = g = b = v;
		return [Math.round(r * 255), Math.round(g * 255), Math.round(b * 255)];
	}
 
	h /= 60; // sector 0 to 5
	i = Math.floor(h);
	f = h - i; // factorial part of h
	p = v * (1 - s);
	q = v * (1 - s * f);
	t = v * (1 - s * (1 - f));
 
	switch(i) {
		case 0:
			r = v;
			g = t;
			b = p;
			break;
 
		case 1:
			r = q;
			g = v;
			b = p;
			break;
 
		case 2:
			r = p;
			g = v;
			b = t;
			break;
 
		case 3:
			r = p;
			g = q;
			b = v;
			break;
 
		case 4:
			r = t;
			g = p;
			b = v;
			break;
 
		default: // case 5:
			r = v;
			g = p;
			b = q;
	}
 
	return [Math.round(r * 255), Math.round(g * 255), Math.round(b * 255)];
}


// devicemotion 繧､繝吶Φ繝医ワ繝ｳ繝峨Λ
window.addEventListener('devicemotion', function(event) {
var x = event.acceleration.x; // X霆ｸ縺ｮ蜉�騾溷ｺｦ
var y = event.acceleration.y; // Y霆ｸ縺ｮ蜉�騾溷ｺｦ
var z = event.acceleration.z; // Z霆ｸ縺ｮ蜉�騾溷ｺｦ
var blk = 0.2;

	tot += (Math.abs(x) + Math.abs(y) + Math.abs(z))*blk;

	document.getElementById("strx").textContent="X: " +x;
	document.getElementById("stry").textContent="Y: " +y;
	document.getElementById("strz").textContent="Z: " +z;
	document.getElementById("strtot").textContent="T: " +tot;

	tot *= 0.91;

	var rgbc = hsvToRgb(colortot, 100, Math.min(tot,100) );
	document.getElementById('bdy').style.backgroundColor= "rgb( "+rgbc[0]+", "+rgbc[1]+", "+rgbc[2]+" )";
});

function xTest() {
		socket.emit('my other event', { my: 'data' });
	}
</script>

</html>